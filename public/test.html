<html>
<head>
	<title>Test</title>
</head>
<body>
<div id="show"></div>

<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.js"></script>
<script src="js/shared.js"></script>
<script src="/socket.io/socket.io.js"></script>

<script>

	var $show = $('#show')

	function rotateMatrix(matrix, n) {

		var rotMatrix,
				_n, y , x

		for (n = 0; _n < n; _n++) {
			rotMatrix = newMatrix(matrix.length, matrix[0].length)
			for (y = 0; y < matrix.length; y++) {
				for (x = 0; x < matrix[0].length; x++) {
					rotMatrix[x][matrix[0].length - 1 - y] = matrix[y][x]
				}
			}
			matrix = rotMatrix
		}

		return matrix
	}

	var socket = io.connect('http://localhost'),
			field = []

	socket.on('base', function (data) {

		var field = []

		for (var y = 0; y < data.field.length; y++) {
			field.push([]);
			for (var x = 0; x < data.field[y].length; x++) {
				if (data.field[y][x]) {
					field[y].push(1);
				} else {
					field[y].push(0);
				}
			}
		}

		for (var i = 0; i < data.players.length; i++) {

			var player = data.players[i],
					x = player.position[0],
					y = player.position[1],
					matrix = rotateMatrix(shared.types[player.type], player.rotation)

			for (var dy = 0; dy < matrix.length; dy++) {
				for (var dx = 0; dx < matrix[0].length; dx++) {
					if (matrix[dy][dx]) {
						field[dx + x][dy + y] = 1
					}
				}
			}
		}

		$show.empty()

		for (var y = 0; y < field.length; y++) {

			$show.append("<br>")

			for (var i = 0; i < field[y].length; i++) {
				$('#show').append(field[i][y])
			}

			$show.append("    " + y)
		}

		$show.append("<br>pos: " + data.players[0].position)
	})
	// socket.emit('update', { my: 'data' });
</script>
</body>
</html>

<!-- data example

  {
    players: [
            {name:"dustin",
            position: [0,0],
            rotation: 90,
            type: 1,
            id: 800}

                ],
    field: [
            [{type:1,owner:1,id:1},...],
            [{type:1,owner:1,id:1},...],
            ...
            [undefinded],
            ...
            ]

} -->
